(()=>{"use strict";var t={26:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BinaryFormula=e.BinaryFunction=e.BinaryOperator=void 0;var r=function(){function t(t,e,r,n){this.symbol=t,this.precedence=e,this.left=r,this.operation=n}return t.prototype.create=function(t,e){return new o(this.operation,t,e)},t}();e.BinaryOperator=r;var n=function(){function t(t,e){this.name=t,this.operation=e}return t.prototype.create=function(t,e){return new o(this.operation,t,e)},t}();e.BinaryFunction=n;var o=function(){function t(t,e,r){this.operation=t,this.left=e,this.right=r}return t.prototype.evaluate=function(){return this.operation(this.left.evaluate(),this.right.evaluate())},t}();e.BinaryFormula=o},286:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.create=void 0,e.create=function(){return new(function(){function t(){this.stack=[]}return t.prototype.peek=function(){return this.stack[this.stack.length-1]},t.prototype.pop=function(){return this.stack.pop()},t.prototype.push=function(t){this.stack.push(t)},t.prototype.size=function(){return this.stack.length},t}())}},769:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Enviroment=void 0;var n=r(26),o=r(782),i=r(746),s=function(){function t(){this.unary=[],this.binary=[],this.symbols=[o.LEFT_PAREN,o.RIGHT_PAREN,o.COMMA],this.constants=new Map,this.variables=new Map,this.unaryOperators=new Map,this.binaryOperators=new Map,this.unaryFunctions=new Map,this.binaryFunctions=new Map}return t.prototype.registerConstant=function(t,e){this.constants.set(t,e)},t.prototype.registerVariable=function(t,e){this.variables.set(t,e)},t.prototype.registerUnaryOperator=function(t,e,r){this.unaryOperators.set(t,new i.UnaryOperator(t,e,r)),this.registerOperatorToken(o.TokenType.UNARY_OPERATOR,t,this.unary)},t.prototype.registerBinaryOperator=function(t,e,r,i){this.binaryOperators.set(t,new n.BinaryOperator(t,e,r,i)),this.registerOperatorToken(o.TokenType.BINARY_OPERATOR,t,this.binary)},t.prototype.registerUnaryFunction=function(t,e){this.unaryFunctions.set(t,new i.UnaryFunction(t,e))},t.prototype.registerBinaryFunction=function(t,e){this.binaryFunctions.set(t,new n.BinaryFunction(t,e))},t.prototype.isConstant=function(t){return this.constants.has(t)},t.prototype.isVariable=function(t){return this.variables.has(t)},t.prototype.isUnaryOperator=function(t){return this.unaryOperators.has(t)},t.prototype.isBinaryOperator=function(t){return this.binaryOperators.has(t)},t.prototype.isUnaryFunction=function(t){return this.unaryFunctions.has(t)},t.prototype.isBinaryFunction=function(t){return this.binaryFunctions.has(t)},t.prototype.isFunction=function(t){return this.isUnaryFunction(t)||this.isBinaryFunction(t)},t.prototype.getConstant=function(t){return this.constants.get(t)},t.prototype.getVariable=function(t){return this.variables.get(t)},t.prototype.getUnaryOperator=function(t){return this.unaryOperators.get(t)},t.prototype.getBinaryOperator=function(t){return this.binaryOperators.get(t)},t.prototype.getUnaryFunction=function(t){return this.unaryFunctions.get(t)},t.prototype.getBinaryFunction=function(t){return this.binaryFunctions.get(t)},t.prototype.registerOperatorToken=function(t,e,r){var n;for(n=0;n<r.length&&!(r[n].symbol.length<e.length);n++);var i=e.replace("","\\")+"\\",s=i.substring(0,i.length-1),a=new o.Token(t,new RegExp(s),e);r.splice(n,0,a)},t.createDefault=function(){var e=new t;return e.registerConstant("pi",Math.PI),e.registerConstant("e",Math.E),e.registerUnaryOperator("+",4,(function(t){return+t})),e.registerUnaryOperator("-",4,(function(t){return-t})),e.registerBinaryOperator("+",2,!0,(function(t,e){return t+e})),e.registerBinaryOperator("-",2,!0,(function(t,e){return t-e})),e.registerBinaryOperator("*",3,!0,(function(t,e){return t*e})),e.registerBinaryOperator("/",3,!0,(function(t,e){return t/e})),e.registerBinaryOperator("%",3,!0,(function(t,e){return t%e})),e.registerBinaryOperator("^",4,!1,(function(t,e){return Math.pow(t,e)})),e.registerUnaryFunction("sqrt",Math.sqrt),e.registerUnaryFunction("abs",Math.abs),e.registerUnaryFunction("ceil",Math.ceil),e.registerUnaryFunction("floor",Math.floor),e.registerUnaryFunction("round",Math.round),e.registerUnaryFunction("sin",Math.sin),e.registerUnaryFunction("cos",Math.cos),e.registerUnaryFunction("tan",Math.tan),e.registerBinaryFunction("min",Math.min),e.registerBinaryFunction("max",Math.max),e},t}();e.Enviroment=s},341:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.unmatchedParenthesisError=e.unknownTokenError2=e.unknownTokenError=e.unexpectedTokenError=e.parserError=e.lexerError=e.formulaError=e.argumentMismatchError=e.createError=void 0;var n=r(782),o=function(){return process.exit(1)},i=function(t){return console.error(t)};e.createError=function(t,e,r,n){var s,a,u=(s=n+1,(a=new Array(s).fill(" "))[s-1]="^",a.join(""));-1===n&&(i("["+t+"] "+e),o()),i("["+t+"] "+e+"\n"+r+"\n"+u),o()},e.argumentMismatchError=function(t,r,n,o){var i=t.value,s=function(t){if(0==t)return"";var e="a".charCodeAt(0),r="";r+=e;for(var n=1;n<t;n++)r+=",",r+=++e;return r.toString()}(r),a=n<r?"Not enough arguments for "+i+"("+s+"), expected "+r+", got "+n:"Too many arguments for "+i+"("+s+"), expected "+r+", got "+n;e.createError("Argument Mismatch",a,o,t.pos)},e.formulaError=function(t,r,n){return e.createError("Formula",t,r,n)},e.lexerError=function(t,r,n){return e.createError("Lexer",t,r,n)},e.parserError=function(t,r,n){return e.createError("Parser",t,r,n)},e.unexpectedTokenError=function(t,r){return e.createError("Unexpected Token","Unexpected token '"+t.value+"' in column "+(t.pos+1),r,t.pos)},e.unknownTokenError=function(t,r,n){return e.createError("Unknown Token","Unknown "+t+" '"+r.value+"' in column "+r.pos,n,r.pos)},e.unknownTokenError2=function(t,r,n,o){return e.createError("Unknown Token","Unknown "+t+" '"+r+"' in column "+o,n,o)},e.unmatchedParenthesisError=function(t,r){return e.createError("Unmatched Parenthesis","Unmatched "+(t.token.type===n.TokenType.LEFT_PAREN?"left":"right")+" parenthesis '"+t.value+"' in column "+(t.pos+1),r,t.pos)}},434:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FormulaManager=e.ValueFormula=void 0;var n=r(341),o=r(688),i=r(417),s=function(){function t(t){this.result=t}return t.prototype.evaluate=function(){return this.result},t}();e.ValueFormula=s;var a=function(){function t(t){this.env=t,this.lexer=new o.Lexer(t),this.parser=new i.Parser(t)}return t.prototype.parse=function(t){0===t.length&&n.createError("Formula Manager","Cannot create a formula out of nothing","",-1);var e=this.lexer.tokenize(t);return this.parser.parse(t,e)},t}();e.FormulaManager=a},688:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&n(e,t,r);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Lexer=e.Lexeme=void 0;var s=i(r(341)),a=r(782),u=function(){function t(t,e,r){this.token=t,this.value=e,this.pos=r}return t.prototype.toString=function(){return this.token.type+" '"+this.value+"'"},t}();e.Lexeme=u;var p=function(){function t(t){this.env=t}return t.prototype.tokenize=function(t){this.result=[],this.input=t,this.pos=0,this._tokenize();var e=this.result;return this.result=void 0,this.input=void 0,this.pos=-1,e},t.prototype._tokenize=function(){for(;this.pos<this.input.length;)this._skipWhitespace(),this._nextToken()},t.prototype._skipWhitespace=function(){for(var t=this.pos;t<this.input.length;t++){var e=this.input.charAt(t);if(!/\s/g.test(e))return void(this.pos=t)}},t.prototype._nextToken=function(){this._nextNumber()||this._nextIdentifier()||this._nextVariable()||this._nextOperator()||this._nextSymbol()||(console.log(this.input.substring(this.pos)),s.lexerError("Unexpected token in column "+(this.pos+1)+".",this.input,this.pos))},t.prototype._nextNumber=function(){var t=this.input.charAt(this.pos);if(isNaN(t))return!1;var e=this.input.substring(this.pos),r=a.NUMBER.match(e);r<0&&s.lexerError("Invalid number in column "+(this.pos+1)+".",this.input,this.pos);var n=this.input.substring(this.pos,this.pos+r);return this.result.push(new u(a.NUMBER,n,this.pos)),this.pos+=r,!0},t.prototype._nextIdentifier=function(){var t;if(1!==(t=this.input.charAt(this.pos)).length||!t.match(/[a-z]/i))return!1;var e=this.input.substring(this.pos),r=a.IDENTIFIER.match(e);r<0&&s.lexerError("Invalid identifier in column "+(this.pos+1)+".",this.input,this.pos),this.pos+r<this.input.length&&">"==this.input.charAt(this.pos+r)&&s.lexerError("Unmatched right bracket in column "+(this.pos+1)+".",this.input,this.pos);var n=this.input.substring(this.pos,this.pos+r);return this.env.isConstant(n)||this.env.isFunction(n)||s.unknownTokenError2("identifier",n,this.input,this.pos),this.result.push(new u(a.IDENTIFIER,n,this.pos)),this.pos+=r,!0},t.prototype._nextVariable=function(){var t=this.input.charAt(this.pos);if(">"===t&&s.lexerError("Unmatched right bracket in column "+(this.pos+1)+".",this.input,this.pos),"<"!==t)return!1;var e=this.input.substring(this.pos),r=a.VARIABLE.match(e);r<0&&s.lexerError("Invalid variable in column "+(this.pos+1)+".",this.input,this.pos),(r>=e.length||">"!==e.charAt(r))&&s.lexerError("Unmatched left bracket in column "+(this.pos+1)+".",this.input,this.pos);var n=this.input.substring(this.pos,this.pos+r);return this.env.isVariable(n)||s.unknownTokenError2("variable","<"+n+">",this.input,this.pos),this.result.push(new u(a.VARIABLE,n,this.pos)),this.pos+=r+1,!0},t.prototype._nextOperator=function(){return this._isUnaryTokenExpected()?this._nextUnaryOperator():this._nextBinaryOperator()},t.prototype._nextUnaryOperator=function(){return this._nextToken2(this.env.unary)},t.prototype._nextBinaryOperator=function(){return this._nextToken2(this.env.binary)},t.prototype._nextSymbol=function(){return this._nextToken2(this.env.symbols)},t.prototype._nextToken2=function(t){for(var e=this.input.substring(this.pos),r=0,n=t;r<n.length;r++){var o=n[r],i=o.match(e);if(!(i<0)){var s=this.input.substring(this.pos,this.pos+i);return this.result.push(new u(o,s,this.pos)),this.pos+=i,!0}}return!1},t.prototype._isUnaryTokenExpected=function(){if(0===this.result.length)return!0;var t=this.result[this.result.length-1];switch(t.token.type){case a.TokenType.LEFT_PAREN:case a.TokenType.UNARY_OPERATOR:case a.TokenType.BINARY_OPERATOR:case a.TokenType.COMMA:return!0;case a.TokenType.NUMBER:case a.TokenType.IDENTIFIER:case a.TokenType.VARIABLE:case a.TokenType.RIGHT_PAREN:return!1}s.unknownTokenError("symbol",t,this.input)},t}();e.Lexer=p},417:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&n(e,t,r);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var s=r(286),a=i(r(341)),u=r(434),p=r(782),h=function(){function t(t){this.env=t}return t.prototype.parse=function(t,e){this.output=s.create(),this.stack=s.create(),this.args=s.create(),this.source=t,this.input=e;var r=this._parse();return this.output=void 0,this.stack=void 0,this.args=void 0,this.source=void 0,this.input=void 0,r},t.prototype._parse=function(){for(var t=0,e=this.input;t<e.length;t++){var r=e[t];switch(r.token.type){case p.TokenType.NUMBER:this._number(r);break;case p.TokenType.IDENTIFIER:this._identifier(r);break;case p.TokenType.VARIABLE:this._variable(r);break;case p.TokenType.UNARY_OPERATOR:this._unary(r);break;case p.TokenType.BINARY_OPERATOR:this._binary(r);break;case p.TokenType.LEFT_PAREN:this._left(r);break;case p.TokenType.RIGHT_PAREN:this._right(r);break;case p.TokenType.COMMA:this._comma(r);break;default:a.unexpectedTokenError(r,this.source)}}for(;0!==this.stack.size();){var n=this.stack.peek();this._popIfOperator(n)||(n.token.type===p.TokenType.LEFT_PAREN&&a.unmatchedParenthesisError(n,this.source),a.unexpectedTokenError(n,this.source))}if(1!=this.output.size())throw new Error('"WHAT THE FUCK DID I DO WRONG", Arnold Schwarzenegger');return this.output.pop()},t.prototype._number=function(t){var e=t.value;this.output.push(new u.ValueFormula(parseFloat(e)))},t.prototype._identifier=function(t){var e=t.value;if(this.env.isConstant(e)){var r=this.env.getConstant(e);this.output.push(new u.ValueFormula(r))}else{if(this.env.isFunction(e))return this.stack.push(t),void this.args.push(1);a.unknownTokenError("identifier",t,this.source)}},t.prototype._variable=function(t){var e=t.value;this.env.isVariable(e)?this.output.push(this.env.getVariable(e)):a.unknownTokenError("variable",t,this.source)},t.prototype._unary=function(t){var e=t.value;this.env.isUnaryOperator(e)||a.unknownTokenError("unary operator",t,this.source),this.stack.push(t)},t.prototype._binary=function(t){var e=t.value;this.env.isBinaryOperator(e)||a.unknownTokenError("binary operator",t,this.source);for(var r=this.env.getBinaryOperator(e);0!==this.stack.size();){var n=this.stack.peek(),o=n.value;if(n.token.type===p.TokenType.UNARY_OPERATOR){if(this.env.isUnaryOperator(o)||a.unknownTokenError("unary operator",n,this.source),(i=this.env.getUnaryOperator(o)).precedence>r.precedence){this._popIfOperator(n);continue}break}if(n.token.type===p.TokenType.BINARY_OPERATOR){var i;if(this.env.isBinaryOperator(o)||a.unknownTokenError("binary operator",n,this.source),(i=this.env.getBinaryOperator(o)).precedence>r.precedence){this._popIfOperator(n);continue}if(i.precedence===r.precedence&&r.left){this._popIfOperator(n);continue}break}if(n.token.type===p.TokenType.LEFT_PAREN||n.token.type===p.TokenType.RIGHT_PAREN)break;a.unexpectedTokenError(n,this.source)}this.stack.push(t)},t.prototype._left=function(t){this.stack.push(t)},t.prototype._right=function(t){for(0===this.stack.size()&&a.unmatchedParenthesisError(t,this.source);0!==this.stack.size();){var e=this.stack.peek();if(!this._popIfOperator(e)){if(e.token.type===p.TokenType.LEFT_PAREN){this.stack.pop(),0!==this.stack.size()&&this._popIfFunction(this.stack.peek());break}a.unexpectedTokenError(e,this.source)}}},t.prototype._comma=function(t){for(;0!==this.stack.size();){var e=this.stack.peek(),r=e.token.type;this._popIfOperator(e)||r!==p.TokenType.LEFT_PAREN&&(r===p.TokenType.RIGHT_PAREN&&a.unexpectedTokenError(e,this.source),a.unexpectedTokenError(t,this.source))}this.args.push(this.args.pop()+1)},t.prototype._popIfOperator=function(t){var e=t.value;if(t.token.type===p.TokenType.UNARY_OPERATOR){if(this.env.isUnaryOperator(e)){var r=this.env.getUnaryOperator(e),n=this.output.pop();return this.output.push(r.create(n)),this.stack.pop(),!0}a.unknownTokenError("unary operator",t,this.source)}if(t.token.type===p.TokenType.BINARY_OPERATOR){if(this.env.isBinaryOperator(e)){r=this.env.getBinaryOperator(e);var o=this.output.pop(),i=this.output.pop();return this.output.push(r.create(i,o)),this.stack.pop(),!0}a.unknownTokenError("binary operator",t,this.source)}return!1},t.prototype._popIfFunction=function(t){if(t.token.type===p.TokenType.IDENTIFIER){var e=t.value;if(this.env.isUnaryFunction(e)){var r=this.env.getUnaryFunction(e);1!=(o=this.args.pop())&&a.argumentMismatchError(t,1,o,this.source);var n=this.output.pop();this.output.push(r.create(n)),this.stack.pop()}else if(this.env.isBinaryFunction(e)){var o;r=this.env.getBinaryFunction(e),2!=(o=this.args.pop())&&a.argumentMismatchError(t,2,o,this.source);var i=this.output.pop(),s=this.output.pop();this.output.push(r.create(s,i)),this.stack.pop()}}},t}();e.Parser=h},782:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.VARIABLE=e.IDENTIFIER=e.NUMBER=e.COMMA=e.RIGHT_PAREN=e.LEFT_PAREN=e.Token=e.TokenType=void 0,function(t){t[t.NUMBER=0]="NUMBER",t[t.IDENTIFIER=1]="IDENTIFIER",t[t.VARIABLE=2]="VARIABLE",t[t.UNARY_OPERATOR=3]="UNARY_OPERATOR",t[t.BINARY_OPERATOR=4]="BINARY_OPERATOR",t[t.LEFT_PAREN=5]="LEFT_PAREN",t[t.RIGHT_PAREN=6]="RIGHT_PAREN",t[t.COMMA=7]="COMMA"}(r=e.TokenType||(e.TokenType={}));var n=function(){function t(t,e,r){this.type=t,this.pattern=e,this.symbol=r}return t.prototype.match=function(t){var e=t.match(this.pattern);return e&&e.length>0?e[0].length:-1},t.prototype.toString=function(){return void 0===this.symbol?this.type:this.type+" '"+this.symbol+"'"},t}();e.Token=n,e.LEFT_PAREN=new n(r.LEFT_PAREN,/^\(/,"("),e.RIGHT_PAREN=new n(r.RIGHT_PAREN,/^\)/,")"),e.COMMA=new n(r.COMMA,/^,/,","),e.NUMBER=new n(r.NUMBER,/^([0-9]+[.])?[0-9]+([eE][-+]?[0-9]+)?/),e.IDENTIFIER=new n(r.IDENTIFIER,/^\p{L}([0-9]|\p{L})*/u),e.VARIABLE=new n(r.VARIABLE,/^[<]\p{L}(([0-9_-]|\p{L})*([0-9]|\p{L})+)?/u)},746:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnaryFormula=e.UnaryFunction=e.UnaryOperator=void 0;var r=function(){function t(t,e,r){this.symbol=t,this.precedence=e,this.operation=r}return t.prototype.create=function(t){return new o(this.operation,t)},t}();e.UnaryOperator=r;var n=function(){function t(t,e){this.name=t,this.operation=e}return t.prototype.create=function(t){return new o(this.operation,t)},t}();e.UnaryFunction=n;var o=function(){function t(t,e){this.operation=t,this.argument=e}return t.prototype.evaluate=function(){return this.operation(this.argument.evaluate())},t}();e.UnaryFormula=o}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r(769),r(434),r(688),r(417)})();